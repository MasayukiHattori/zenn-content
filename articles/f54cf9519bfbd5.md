---
title: "ASP.NET Core OData + Blazor WebAssembly + Kiota ã§Cookieèªè¨¼ã‚’å®Ÿè£…ã™ã‚‹"
emoji: "ğŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [ "csharp", "blazor", "authentication", "odata", "kiota" ]
published: true
---

## æ¦‚è¦

ASP.NET Core OData + Blazor WebAssembly + Kiota ã‚’ä½¿ç”¨ã—ã¦ã€Cookieèªè¨¼ã‚’å®Ÿè£…ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

Blazor WebAssemblyã®èªè¨¼çŠ¶æ…‹ç®¡ç†ã¨Kiotaã®èªè¨¼çŠ¶æ…‹ç®¡ç†ã‚’çµ±åˆã—ã€Cookieã‚’ä½¿ç”¨ã—ã¦ASP.NET Core OData APIã¸èªè¨¼æ¸ˆã¿ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¡Œã†ã¨ã“ã‚ãŒãƒã‚¤ãƒ³ãƒˆã¨ãªã‚Šã¾ã™ã€‚

- Blazor WebAssemblyã®èªè¨¼çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹`Microsoft.AspNetCore.Components.Authorization.AuthenticationStateProvider`
- Kiotaã®èªè¨¼çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹`Microsoft.Kiota.Abstractions.Authentication.IAuthenticationProvider`

ASP.NET Core OData ã‚„ Kiota ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã‚’ç†è§£ã—ã¦ã„ã‚‹å‰æã§ç´¹ä»‹ã—ã¾ã™ã€‚

## é–‹ç™ºç’°å¢ƒ

ä¸»ãªé–‹ç™ºç’°å¢ƒã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

- .NET 9.0
- Microsoft Visual Studio 2022 Community (64ãƒ“ãƒƒãƒˆ) Version 17.14.7
- C# 13.0
- Windows 11 Pro 64bit 24H2 (OSãƒ“ãƒ«ãƒ‰ 26100.4652)
- Asp.Versioning.OData 8.2.0
- Asp.Versioning.OData.ApiExplorer 8.2.0
- Microsoft.AspNetCore.OData 9.3.2
- Microsoft.Kiota.Bundle 1.19.0

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹æˆ

ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒªã‚’GitHubã«å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚

@[card](https://github.com/MasayukiHattori/BlazorWasmKiotaOData)

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

- ProductsApi:
  - ASP.NET Core OData ã§æ§‹ç¯‰ã—ãŸAPIãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™
  - ASP.NET Core Identityã‚’ä½¿ç”¨ã—ã¦ã€Cookieèªè¨¼ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™
- BlazorWasm:
  - Blazor WebAssembly ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™
  - Kiota ã‚’ä½¿ç”¨ã—ã¦ ProductsApi ã‚’å‘¼ã³å‡ºã—ã¾ã™

ãã‚Œã§ã¯ã€è§£èª¬ã—ã¦ãã¾ã™ã€‚

# ProductsApi ã®å®Ÿè£…

èªè¨¼ç”¨ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’`ProductsApi.Routing.IdentityApiEndpointRouteBuilderExtensions`ã«å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚`ASP.NET Core Identity`ã®å€‹åˆ¥èªè¨¼ã‚’å®Ÿè£…ã—ã¦ã€Cookieèªè¨¼ã‚’æœ‰åŠ¹ã«ã—ã¦ã„ã¾ã™ã€‚

ODataã®å®Ÿè£…ã¨ã—ã¦ã€è£½å“ã®CRUDæ“ä½œã‚’è¡Œã†ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§ã‚ã‚‹`ProductsApi.Controllers.V1.ProductsController`ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚`Asp.Versioning.OData`ã‚’ä½¿ç”¨ã—ã¦ã€ODataã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚

```csharp:ProductsController.cs
using Asp.Versioning;
using Asp.Versioning.OData;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.OData.Deltas;
using Microsoft.AspNetCore.OData.Query;
using Microsoft.AspNetCore.OData.Results;
using Microsoft.AspNetCore.OData.Routing.Controllers;
using ProductsApi.Data;
using ProductsApi.Models;

namespace ProductsApi.Controllers.V1
{
    /// <summary>
    /// è£½å“æƒ…å ±ã‚’ç®¡ç†ã™ã‚‹ OData API ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ (API ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 1.0)ã€‚
    /// è£½å“ã®å–å¾—ã€è¿½åŠ ã€æ›´æ–°ã€å‰Šé™¤ã‚’æä¾›ã—ã¾ã™ã€‚
    /// </summary>
    [ApiVersion("1.0")]
    [Authorize]
    public class ProductsController : ODataController
    {
        private readonly ApplicationDbContext _context;

        /// <summary>
        /// <see cref="ProductsController"/> ã®æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚
        /// </summary>
        /// <param name="context">ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã€‚</param>
        public ProductsController(ApplicationDbContext context)
        {
            _context = context;
        }

        /// <summary>
        /// è£½å“ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚
        /// </summary>
        /// <returns>è£½å“ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</returns>
        [HttpGet]
        [EnableQuery]
        [Produces("application/json")]
        [ProducesResponseType<ODataValue<IEnumerable<Product>>>(StatusCodes.Status200OK)]
        public ActionResult<IEnumerable<Product>> Get() => Ok(_context.Products);

        /// <summary>
        /// æŒ‡å®šã—ãŸã‚­ãƒ¼ã®è£½å“ã‚’å–å¾—ã—ã¾ã™ã€‚
        /// </summary>
        /// <param name="key">è£½å“ID</param>
        /// <returns>è£½å“æƒ…å ±</returns>
        [HttpGet]
        [EnableQuery]
        [Produces("application/json")]
        [ProducesResponseType<Product>(StatusCodes.Status200OK)]
        [ProducesResponseType(StatusCodes.Status404NotFound)]
        public SingleResult<Product> Get(int key)
            => SingleResult.Create(_context.Products.Where(p => p.Id == key));

        /// <summary>
        /// æ–°ã—ã„è£½å“ã‚’è¿½åŠ ã—ã¾ã™ã€‚
        /// </summary>
        /// <param name="product">è¿½åŠ ã™ã‚‹è£½å“æƒ…å ±</param>
        /// <returns>è¿½åŠ çµæœ</returns>
        [HttpPost]
        [Produces("application/json")]
        [ProducesResponseType<Product>(StatusCodes.Status201Created)]
        [ProducesResponseType(StatusCodes.Status400BadRequest)]
        [ProducesResponseType(StatusCodes.Status401Unauthorized)]
        public IActionResult Post([FromBody] Product product)
        {
            if (!ModelState.IsValid)
            {
                return BadRequest(ModelState);
            }

            _context.Products.Add(product);
            _context.SaveChanges();

            var createdProduct = _context.Products.FirstOrDefault(p => p.Id == product.Id);
            return CreatedAtAction(nameof(Get), new { key = createdProduct.Id }, createdProduct);
        }

        /// <summary>
        /// æŒ‡å®šã—ãŸè£½å“æƒ…å ±ã‚’éƒ¨åˆ†æ›´æ–°ã—ã¾ã™ã€‚
        /// </summary>
        /// <param name="key">è£½å“ID</param>
        /// <param name="delta">æ›´æ–°å†…å®¹</param>
        /// <returns>æ›´æ–°çµæœ</returns>
        [HttpPatch]
        [Authorize]
        [Produces("application/json")]
        [ProducesResponseType<Product>(StatusCodes.Status204NoContent)]
        [ProducesResponseType(StatusCodes.Status404NotFound)]
        public IActionResult Patch(int key, [FromBody] Delta<Product> delta)
        {
            var existingProduct = _context.Products.FirstOrDefault(p => p.Id == key);
            if (existingProduct == null)
            {
                return NotFound();
            }

            delta.Patch(existingProduct);

            if (!TryValidateModel(existingProduct))
            {
                return BadRequest(ModelState);
            }

            delta.Patch(existingProduct);
            _context.SaveChanges();

            return NoContent();
        }

        /// <summary>
        /// æŒ‡å®šã—ãŸè£½å“ã‚’å‰Šé™¤ã—ã¾ã™ã€‚
        /// </summary>
        /// <param name="key">è£½å“ID</param>
        /// <returns>å‰Šé™¤çµæœ</returns>
        [HttpDelete]
        [Authorize]
        [Produces("application/json")]
        [ProducesResponseType(StatusCodes.Status204NoContent)]
        [ProducesResponseType(StatusCodes.Status404NotFound)]
        public IActionResult Delete(int key)
        {
            var product = _context.Products.FirstOrDefault(p => p.Id == key);
            if (product == null)
            {
                return NotFound();
            }
            _context.Products.Remove(product);
            _context.SaveChanges();
            return NoContent();
        }
    }
}
```

# Kiotaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ä½œæˆ

`ProductsApi`ã‚’ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œã—ã¾ã™ã€‚OpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒ`https://localhost:7130/swagger/v1/swagger.json`ã§å…¬é–‹ã•ã‚Œã¾ã™ã€‚

Kiotaã‚’ä½¿ç”¨ã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
kiota generate -l csharp -c ApiClient -n BlazorWasm.Client -d https://localhost:7130/swagger/v1/swagger.json
```

ç”Ÿæˆã•ã‚ŒãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã¯ã€`BlazorWasm`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®`Client`ãƒ•ã‚©ãƒ«ãƒ€å†…ã«ã‚ã‚Šã¾ã™ã€‚

# Blazor WebAssembly ã® AuthenticationStateProvider ã‚’å®Ÿè£…ã™ã‚‹

Blazor WebAssemblyã®`AuthenticationStateProvider`ãŠã‚ˆã³Kiotaã®`IAuthenticationProvider`ã‚’å®Ÿè£…ã—ãŸ`CookieAuthenticationStateProvider`ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã®ã‚¯ãƒ©ã‚¹ã¯ã€ASP.NET Core Identityã®Cookieèªè¨¼ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼çŠ¶æ…‹ã‚’ç®¡ç†ã—ã¾ã™ã€‚

`AuthenticationStateProvider`ã®å®Ÿè£…ã§ã¯ã€`GetAuthenticationStateAsync`ãƒ¡ã‚½ãƒƒãƒ‰ã§`ProdutsApi`ã§å®Ÿè£…ã—ãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚èªè¨¼æ¸ˆã¿ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã‚ã‚Œã°`ClaimsPrincipal`ã‚’è¿”ã—ã¾ã™ã€‚æœªèªè¨¼ã®å ´åˆã¯ã€åŒ¿åã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿”ã—ã¾ã™ã€‚

```csharp:CookieAuthenticationStateProvider.cs
public override async Task<AuthenticationState> GetAuthenticationStateAsync()
{
    authenticated = false;

    // default to not authenticated
    var user = unauthenticated;

    try
    {
        // the user info endpoint is secured, so if the user isn't logged in this will fail
        using var userResponse = await _httpClient.GetAsync("manage/info");

        // throw if user info wasn't retrieved
        userResponse.EnsureSuccessStatusCode();

        // user is authenticated,so let's build their authenticated identity
        var userJson = await userResponse.Content.ReadAsStringAsync();
        var userInfo = JsonSerializer.Deserialize<UserInfo>(userJson, jsonSerializerOptions);

        if (userInfo != null)
        {
            // in this example app, name and email are the same
            var claims = new List<Claim>
            {
                new(ClaimTypes.Name, userInfo.Email),
                new(ClaimTypes.Email, userInfo.Email),
            };

            // add any additional claims
            claims.AddRange(
                userInfo.Claims.Where(c => c.Key != ClaimTypes.Name && c.Key != ClaimTypes.Email)
                    .Select(c => new Claim(c.Key, c.Value)));

            // set the principal
            var id = new ClaimsIdentity(claims, nameof(CookieAuthenticationStateProvider));
            user = new ClaimsPrincipal(id);
            authenticated = true;
        }
    }
    catch (Exception ex) when (ex is HttpRequestException exception)
    {
        if (exception.StatusCode != HttpStatusCode.Unauthorized)
        {
            logger.LogError(ex, "App error");
        }
    }
    catch (Exception ex)
    {
        logger.LogError(ex, "App error");
    }

    // return the state
    return new AuthenticationState(user);
}
```

Kiotaã®`IAuthenticationProvider`ã®å®Ÿè£…ã«ãŠã„ã¦ã¯ã€Blazor WebAssemblyã®èªè¨¼çŠ¶æ…‹ã‚’ç¢ºèªã—ã€æœªèªè¨¼ã§ã‚ã‚Œã°`UnauthorizedAccessException`ã‚’ã‚¹ãƒ­ãƒ¼ã™ã‚‹å®Ÿè£…ã¨ã—ã¦ã„ã¾ã™ã€‚

```csharp:CookieAuthenticationStateProvider.cs
public async Task AuthenticateRequestAsync(RequestInformation request, Dictionary<string, object>? additionalAuthenticationContext = null, CancellationToken cancellationToken = default)
{
    var authenticated = await CheckAuthenticatedAsync();
    if (!authenticated)
    {
        throw new UnauthorizedAccessException("User is not authenticated.");
    }
}
```

# CookieAuthenticationStateProvider ã¨ ApiClient ã§ä½¿ç”¨ã™ã‚‹ HttpClient ã«ã¦Cookieã®èªè¨¼æƒ…å ±ã‚’é€ä¿¡ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹

`BlazorWasm`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®`Program.cs`ã«ã¦ã€`Auth`ã¨åå‰ã‚’ä»˜ã‘ãŸ`HttpClient`ã«`CookieHandler`ã‚’è¨­å®šã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ASP.NET Core Identityã®Cookieèªè¨¼æƒ…å ±ãŒè‡ªå‹•çš„ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å«ã¾ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã¾ãŸã€`AttachKiotaHandlers`æ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦Kiotaã«å¿…è¦ãªãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’`IHttpClientBuilder`ã«è¿½åŠ ã—ã¾ã™ã€‚

```csharp:Program.cs
// configure client for auth interactions
builder.Services.AddHttpClient(
    "Auth",
    opt => opt.BaseAddress = new Uri(builder.Configuration["BackendUrl"] ?? "https://localhost:5001"))
    .AddHttpMessageHandler<CookieHandler>()
    .AttachKiotaHandlers();
```

`CookieAuthenticationStateProvider`ã§ã¯`Auth`ã¨ã„ã†åå‰ã®`HttpClient`ã‚’`IHttpClientFactory`ã‹ã‚‰å–å¾—ã—ã¾ã™ã€‚æœ¬`HttpClient`ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§èªè¨¼æƒ…å ±ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å«ã‚ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```csharp:CookieAuthenticationStateProvider.cs
public class CookieAuthenticationStateProvider(IHttpClientFactory httpClientFactory, ILogger<CookieAuthenticationStateProvider> logger)
    : AuthenticationStateProvider, IAccountManagement, IAuthenticationProvider
{

    private readonly HttpClient _httpClient = httpClientFactory.CreateClient("Auth");
}
```

`ApiClient`ã‚’ç”Ÿæˆã™ã‚‹`ApiClientFactory`ã‚¯ãƒ©ã‚¹ã§ã‚‚ã€`Auth`ã¨ã„ã†åå‰ã®`HttpClient`ã‚’`IHttpClientFactory`ã‹ã‚‰å–å¾—ã—ã¾ã™ã€‚åŒã˜ãæœ¬`HttpClient`ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§èªè¨¼æƒ…å ±ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å«ã‚ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```csharp:ApiClientFactory.cs
public class ApiClientFactory
{
    private readonly IAuthenticationProvider _authenticationProvider;
    private readonly HttpClient _httpClient;

    public ApiClientFactory(IHttpClientFactory httpClientFactory, IAuthenticationProvider authenticationProvider)
    {
        _authenticationProvider = authenticationProvider;
        _httpClient = httpClientFactory.CreateClient("Auth");
    }
}
```

# URLã‚’æŒ‡å®šã—ã¦èªè¨¼ãŒå¿…è¦ãªãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å ´åˆã«å¯¾å¿œã™ã‚‹

Blazor WebAssemblyã§ã¯ã€`Authorize`å±æ€§ã¯ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ã‚ˆã‚‹ãƒšãƒ¼ã‚¸é·ç§»ã®ã¿æ©Ÿèƒ½ã—ã¾ã™ã€‚ãã®ç‚ºã€URLã‚’ç›´æ¥å…¥åŠ›ã—ã¦èªè¨¼ãŒå¿…è¦ãªãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹å ´åˆã«å‚™ãˆã¦`Products.razor`ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

`IAuthenticationProvider`ã®å®Ÿè£…ã§ã¯æœªèªè¨¼ã®å ´åˆã¯`UnauthorizedAccessException`ã‚’ã‚¹ãƒ­ãƒ¼ã™ã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã—ãŸã®ã§ã€Kiotaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ç®‡æ‰€ã§`UnauthorizedAccessException`ä¾‹å¤–ã‚’ã‚­ãƒ£ãƒƒãƒã—ãŸå ´åˆã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸é·ç§»ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

```csharp:Products.razor
@code {
    private List<Product>? _products;

    [CascadingParameter]
    private Task<AuthenticationState> AuthenticationState { get; set; } = null!;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationState;
        var user = authState.User;
        if (!user.Identity?.IsAuthenticated ?? true) return;

        try
        {
            var response = await ApiClient.Odata.Products.GetAsync();
            _products = response?.Value ?? new List<Product>();
        }
        catch (UnauthorizedAccessException)
        {
            Navigation.NavigateTo("login");
        }
    }
}
```

# å‹•ä½œç¢ºèª

ãƒãƒ«ãƒã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ`test`ã‚’ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œã—ã¦ã€`ProductsApi`ã¨`BlazorWasm`ã‚’èµ·å‹•ã—ã¾ã™ã€‚åŒæ™‚ã«Swagger UIãŒèµ·å‹•ã—ã¾ã™ã®ã§ã€å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‹ã‚‰äºˆã‚é©å½“ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã—ã¦ãŠãã¾ã™ã€‚

`BlazorWasm`ã®ç”»é¢å³ä¸Šã®Loginã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ç™»éŒ²ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚

![](/images/f54cf9519bfbd5/login.png)

å·¦å´ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«`Products`ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€`ApiClient`ãŒCookieã®èªè¨¼æƒ…å ±ã¨ä¸€ç·’ã«`https://localhost:7130/odata/products`ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€è£½å“ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™ã€‚

![](/images/f54cf9519bfbd5/products.png)

ä»Šåº¦ã¯Logoutã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã€‚ãã®å¾Œã€`https://localhost:7258/products`ã®URLã‚’ç›´æ¥å…¥åŠ›ã—ã¦ã—ã¦`Products`ãƒšãƒ¼ã‚¸ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€Kiotaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯`UnauthorizedAccessException`ã‚’ã‚¹ãƒ­ãƒ¼ã—ã€ä¾‹å¤–å‡¦ç†ã«ã‚ˆã‚Šãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚

![](/images/f54cf9519bfbd5/unauthorized.png)
