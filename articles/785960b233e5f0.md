---
title: "EF Coreã«ãŠã„ã¦UTCã§ä¿å­˜ã—ãŸæ—¥æ™‚ã‚’JSTã«å¤‰æ›ã—ã¦è¡¨ç¤ºã™ã‚‹æ–¹æ³•"
emoji: "ğŸ—“ï¸"
type: "tech"
topics:
  - "csharp"
  - "postgresql"
  - "visualstudio"
  - "blazor"
  - "entityframework"
published: true
published_at: "2023-10-17 17:38"
---

# æ¦‚è¦
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¸Šã§ã¯æ—¥æ™‚ã‚’UTCï¼šUniversal time coordinatedï¼ˆå”å®šä¸–ç•Œæ™‚ï¼‰ã¨ã—ã¦ä¿å­˜ã™ã‚‹ãŒã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç”»é¢ä¸Šã§ã¯JSTï¼ˆæ—¥æœ¬æ¨™æº–æ™‚ï¼‰ã«å¤‰æ›ã—ã¦è¡¨ç¤ºã™ã‚‹æ–¹æ³•ã‚’EntityFramework Coreã‚’ä½¿ç”¨ã—ã¦èª¬æ˜ã—ã¾ã™ã€‚

## é–‹ç™ºç’°å¢ƒ
- .NET 7.0
- Microsoft Visual Studio 2022 Community (64ãƒ“ãƒƒãƒˆ) Version 17.7.3
- C# 11.0
- Windows 10 Pro 64bit 22H2 (OSãƒ“ãƒ«ãƒ‰ 19045.3208)
- PostgreSQL 15.3

## å¯¾è±¡èª­è€…
- EntityFramework Coreã‚’ä½¿ã£ãŸé–‹ç™ºã‚’ã•ã‚Œã¦ã„ã‚‹æ–¹
- ã©ã†ã—ã¦ã‚‚æ—¥æ™‚ã‚’UTCã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã—ãªã„ã¨ã„ã‘ãªã„æ–¹

# ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆ
Blazor Serverã§Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã—ã¾ã™ã€‚æ—¥æ™‚ã®ãƒ‡ãƒ¼ã‚¿ã‚’JSTã¨ã—ã¦è¡¨ç¤ºï¼å…¥åŠ›ã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã™ã‚‹æ™‚ã¯UTCã«å¤‰æ›ã™ã‚‹ã‚ˆã†ãªç°¡å˜ãªWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚

## å‰ææ¡ä»¶
äºˆã‚PostgreSQLã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ä¸Šã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã‚‹ã‚‚ã®ã¨ã—ã¦é€²ã‚ã¦ã„ãã¾ã™ã€‚åˆ¥ã®å ´æ‰€ã«PostgreSQLã‚’ç”¨æ„ã—ã¦ã„ã‚‹å ´åˆã¯PostgreSQLã®ã‚µãƒ¼ãƒãƒ¼åã‚’é©å®œèª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
1. Blazor Serverã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/c04f7bedd173-20231017.png)
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¯EFCoreUTCã¨ã—ã¾ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/965c5e8223e5-20231017.png)
3. èªè¨¼ã®ç¨®é¡ã¯ã€Œãªã—ã€ã€HTTPSç”¨ã®æ§‹æˆã‚‚ä»Šå›ã¯å¿…è¦ãªã„ã®ã§ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/c1f75241f778-20231017.png)
4. NuGetãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç®¡ç†ã‹ã‚‰ä¸‹è¨˜ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
- Microsoft.EntityFrameworkCore.Design 7.0.12
- Npgsql.EntityFrameworkCore.PostgreSQL 7.0.11

## ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…
1. ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å‹ã‚’ä½œæˆã—ã¾ã™ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›´ä¸‹ã«Modelsãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã€Modelsãƒ•ã‚©ãƒ«ãƒ€å†…ã«Todoã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚
``` diff cs:Models/Todo.cs
using System.ComponentModel.DataAnnotations;

namespace EFCoreUTC.Models
{
    public class Todo
    {
        public int Id { get; set; }
        [Required]
        [StringLength(20)]
        public string Title { get; set; } = null!;
        [Required]
        [StringLength(100)]
        public string Memo { get; set; } = null!;
        [Required]
        public DateTime ExecutionDate { get; set; }
    }
}
```
2. DbContextã‚’ä½œæˆã—ã¾ã™ã€‚Dataãƒ•ã‚©ãƒ«ãƒ€å†…ã«DbContextã‚’ç¶™æ‰¿ã—ãŸTodoContextã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚
``` diff cs:Data/TodoContext.cs
using EFCoreUTC.Models;
using Microsoft.EntityFrameworkCore;

namespace EFCoreUTC.Data
{
    public class TodoContext : DbContext
    {
        public DbSet<Todo> Todos { get; set; }

        public TodoContext(DbContextOptions options) : base(options)
        {
        }
    }
}
```
3. appsettings.jsonã«DBæ¥ç¶šæ–‡å­—åˆ—ã‚’è¿½è¨˜ã—ã¾ã™ã€‚æ¥ç¶šæ–‡å­—åˆ—ã¯ãŠä½¿ã„ã®ç’°å¢ƒã«åˆã‚ã›ã¦é©å®œå¤‰æ›´ã—ã¦ãã ã•ã„ã€‚
``` diff json:appsettings.json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
+  "ConnectionStrings": {
+    "DefaultConnectionString": "Host=localhost;Username=user;Password=password;Database=Todo;Timeout=15"
+  },
  "AllowedHosts": "*"
}
```
4. Microsoft.EntityFrameworkCore.Design.IDesignTimeDbContextFactory<TContext> ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚’å®Ÿè£…ã—ã¦EF Coreãƒ„ãƒ¼ãƒ«ã«DbContextã®ä½œæˆæ–¹æ³•ã‚’ä¼ãˆã¾ã™ã€‚Dataãƒ•ã‚©ãƒ«ãƒ€å†…ã«IDesignTimeDbContextFactory<TContext>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã—ãŸTodoContextFactoryã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚
``` diff cs:Data/TodoContextFactory.cs
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Design;

namespace EFCoreUTC.Data
{
    public class TodoContextFactory : IDesignTimeDbContextFactory<TodoContext>
    {
        public TodoContext CreateDbContext(string[] args)
        {
            //appsettings.jsonã‹ã‚‰DBæ¥ç¶šæ–‡å­—åˆ—ã‚’å–å¾—ã™ã‚‹
            IConfigurationRoot configuration = new ConfigurationBuilder()
                .SetBasePath(Directory.GetCurrentDirectory())
                .AddJsonFile("appsettings.json")
                .Build();
            var connectionString = configuration.GetConnectionString("DefaultConnectionString");

            var optionBuilder = new DbContextOptionsBuilder<TodoContext>();
            optionBuilder.UseNpgsql(connectionString);

            return new TodoContext(optionBuilder.Options);
        }
    }
}
```
5. ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚Dataãƒ•ã‚©ãƒ«ãƒ€å†…ã«TodoServiceã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚
``` diff cs:Data/TodoService.cs
using EFCoreUTC.Models;
using Microsoft.EntityFrameworkCore;

namespace EFCoreUTC.Data
{
    public class TodoService
    {
        private readonly TodoContext _context;

        public TodoService(TodoContext context)
        {
            _context = context;
        }

        public async Task<IEnumerable<Todo>> GetTodosAsync() =>
            await _context.Todos.OrderByDescending(x => x.ExecutionDate).ToListAsync();

        public async Task<int> AddAsync(Todo todo)
        {
            _context.Todos.Add(todo);
            return await _context.SaveChangesAsync();
        }
    }
}
```
6. Todoã®ä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™ã€‚Pagesãƒ•ã‚©ãƒ«ãƒ€ã«Todosã¨ã„ã†åå‰ã®Razorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
``` diff razor:Pages/Todos.razor
@page "/todos"
@using EFCoreUTC.Data;
@using EFCoreUTC.Models;
@inject TodoService TodoService;

<h1>Todos</h1>

@if (todos == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <div class="mt-4 mb-4"><a href="/todos/add">Add</a></div>

    <table class="table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Title</th>
                <th>Memo</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var todo in todos)
            {
                <tr>
                    <td>@todo.ExecutionDate.ToString("yyyy/MM/dd HH:mm:ss")</td>
                    <td>@todo.Title</td>
                    <td>@todo.Memo</td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    private IEnumerable<Todo>? todos;

    protected override async Task OnInitializedAsync()
    {
        todos = await TodoService.GetTodosAsync();
    }
}
```
7. Todoã‚’è¿½åŠ ã™ã‚‹ãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™ã€‚Pagesãƒ•ã‚©ãƒ«ãƒ€ã«AddTodoã¨ã„ã†åå‰ã®Razorã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
``` diff razor:Pages/AddTodo.razor
@page "/todos/add"
@using EFCoreUTC.Data;
@using EFCoreUTC.Models;
@inject TodoService TodoService;
@inject NavigationManager NavigationManager;

<h1>Add Todo</h1>

<EditForm Model="@_model" OnValidSubmit="SubmitAsync">
    <DataAnnotationsValidator />
    <div class="container">
        <div class="row mb-2">
            <label for="title" class="col">
                Title:
                <InputText x:id="title" @bind-Value="@_model.Title" />
                <ValidationMessage For="@(()=>_model.Title)" />
            </label>
        </div>
        <div class="row mb-2">
            <label for="memo" class="col">
                Memo:
                <InputText @bind-Value="@_model.Memo" />
                <ValidationMessage For="@(()=>_model.Memo)" />
            </label>
        </div>
        <div class="row mb-2">
            <label for="executionDate" class="col">
                Execution Date:
                <InputDate Type="InputDateType.DateTimeLocal" @bind-Value:format="yyyy/MM/dd HH:mm:ss" @bind-Value="@_model.ExecutionDate" />
                <ValidationMessage For="@(()=>_model.ExecutionDate)" />
            </label>
        </div>
        <div class="row">
            <div class="col">
                <button type="submit">Submit</button>
            </div>
        </div>
    </div>
</EditForm>

@code {
    private Todo _model = new()
        {
            ExecutionDate = DateTime.Now
        };

    private async Task SubmitAsync(EditContext editContext)
    {
        if (!editContext.Validate()) return;

        //Add Todo
        await TodoService.AddAsync(_model);

        //Navigate to todos
        NavigationManager.NavigateTo("/todos");
    }
}
```
8. Todoã®ä¸€è¦§ã¸ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã¾ã™ã€‚Shared/NavMenu.razorã«Todoä¸€è¦§ã¸ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã¾ã™ã€‚
``` diff razor:Shared/NavMenu.razor
<div class="top-row ps-3 navbar navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="">EFCoreUTC</a>
        <button title="Navigation menu" class="navbar-toggler" @onclick="ToggleNavMenu">
            <span class="navbar-toggler-icon"></span>
        </button>
    </div>
</div>

<div class="@NavMenuCssClass nav-scrollable" @onclick="ToggleNavMenu">
    <nav class="flex-column">
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                <span class="oi oi-home" aria-hidden="true"></span> Home
            </NavLink>
        </div>
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="counter">
                <span class="oi oi-plus" aria-hidden="true"></span> Counter
            </NavLink>
        </div>
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="fetchdata">
                <span class="oi oi-list-rich" aria-hidden="true"></span> Fetch data
            </NavLink>
        </div>
+        <div class="nav-item px-3">
+            <NavLink class="nav-link" href="todos">
+                <span class="oi oi-list-rich" aria-hidden="true"></span> Todo
+            </NavLink>
+        </div>
    </nav>
</div>

@code {
    private bool collapseNavMenu = true;

    private string? NavMenuCssClass => collapseNavMenu ? "collapse" : null;

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }
}
```
9. EF Coreãƒ„ãƒ¼ãƒ«ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚
``` diff powershell
dotnet ef migrations Add InitialCreate
dotnet ef database update
```
10. Program.csã‚’ç·¨é›†ã—ã¦ã€æ±ç”¨ãƒ›ã‚¹ãƒˆã«ã‚µãƒ¼ãƒ“ã‚¹ã¨DbContextã‚’è¨­å®šã—ã¾ã™ã€‚
``` diff cs:Program.cs
using EFCoreUTC.Data;
using Microsoft.EntityFrameworkCore;

var builder = WebApplication.CreateBuilder(args);

// Add services to the container.
builder.Services.AddRazorPages();
builder.Services.AddServerSideBlazor();
builder.Services.AddSingleton<WeatherForecastService>();
+builder.Services.AddTransient<TodoService>();

+// DbContext
+var constr = builder.Configuration.GetConnectionString("DefaultConnectionString");
+builder.Services.AddDbContext<TodoContext>(options =>
+    options.UseNpgsql(constr));

var app = builder.Build();

// Configure the HTTP request pipeline.
if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");
}


app.UseStaticFiles();

app.UseRouting();

app.MapBlazorHub();
app.MapFallbackToPage("/_Host");

app.Run();
```
11. ã“ã“ã§ä¸€æ—¦ã€ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚Todoã®ä¸€è¦§ã‚’è¡¨ç¤ºã—ã¦Addãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/355d997edb1d-20231017.png)
12. å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ã€Submitã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚ã™ã‚‹ã¨ä¾‹å¤–ãŒç™ºç”Ÿã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/2c6c0b844af4-20231017.png)
13. ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›ã‚’ç¢ºèªã™ã‚‹ã¨Microsoft.EntityFrameworkCore.DbUpdateExceptionä¾‹å¤–ãŒç™ºç”Ÿã—ã€å†…éƒ¨ä¾‹å¤–ã«
```
System.InvalidCastException: Cannot write DateTime with Kind=Unspecified to PostgreSQL type 'timestamp with time zone', only UTC is supported. Note that it's not possible to mix DateTimes with different Kinds in an array/range. See the Npgsql.EnableLegacyTimestampBehavior AppContext switch to enable legacy behavior.
```
ã¨å‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹ã®ãŒç¢ºèªã§ãã¾ã™ã€‚ã“ã‚Œã¯PostgreSQLã®timestamp with timezoneå‹ãŒUTCã®ã¿ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ãŸã‚ã«ç™ºç”Ÿã—ã¾ã™ã€‚ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³æƒ…å ±ãŒä»˜ä¸ã•ã‚ŒãŸJSTã¨ã—ã¦ExecutionDateã®å€¤ã‚’ç™»éŒ²ã—ã‚ˆã†ã¨ã—ã¦ä¾‹å¤–ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚

https://www.npgsql.org/doc/types/datetime.html

14. ä¾‹å¤–ã‚’å›é¿ã™ã‚‹ãŸã‚ã«DateTimeå‹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã™ã‚‹æ™‚ã¯JSTã‚’UTCã«å¤‰æ›ã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å–å¾—ã™ã‚‹æ™‚ã¯UTCã‚’JSTã«å¤‰æ›ã™ã‚‹ã‚ˆã†ã«ã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚TodoContext.csã«ã¦OnModelCreatingã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã€Microsoft.EntityFrameworkCore.Storage.ValueConversion.ValueConverterã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚ValueConverterã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®ç¬¬ï¼‘å¼•æ•°ã«ã¯ã€ã‚¹ãƒˆã‚¢ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€ã¨ãã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å¤‰æ›ã™ã‚‹å¼ã‚’è¨˜è¼‰ã—ã€ç¬¬ï¼’å¼•æ•°ã«ã¯ã‚¹ãƒˆã‚¢ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚‹ã¨ãã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å¤‰æ›ã™ã‚‹å¼ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚
``` diff cs:Data/TodoContext.cs OnModelCreatingãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŠœç²‹
+        protected override void OnModelCreating(ModelBuilder modelBuilder)
+        {
+            //DateTimeã‚’UTCã§ä¿å­˜ã™ã‚‹ç‚ºã€UTCâ‡”JSTå¤‰æ›ã‚’ã™ã‚‹
+            var jstZoneInfo = TimeZoneInfo.FindSystemTimeZoneById("Tokyo Standard Time");
+            var datetimeConverter = new ValueConverter<DateTime, DateTime>(
+                v => v.Kind == DateTimeKind.Utc ? v : TimeZoneInfo.ConvertTimeToUtc(v, TimeZoneInfo.Local),
+                v => v.Kind == DateTimeKind.Utc ? TimeZoneInfo.ConvertTimeFromUtc(v, TimeZoneInfo.Local) : v);
+        }
```
15. Todoã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ExecutionDateãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å¯¾ã—ã¦HasConversionãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ä½œæˆã—ãŸã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼ã‚’é©ç”¨ã—ã¾ã™ã€‚
``` diff cs:Data/TodoContext.cs OnModelCreatingãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŠœç²‹
        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            //DateTimeã‚’UTCã§ä¿å­˜ã™ã‚‹ç‚ºã€UTCâ‡”JSTå¤‰æ›ã‚’ã™ã‚‹
            var jstZoneInfo = TimeZoneInfo.FindSystemTimeZoneById("Tokyo Standard Time");
            var datetimeConverter = new ValueConverter<DateTime, DateTime>(
                v => v.Kind == DateTimeKind.Utc ? v : TimeZoneInfo.ConvertTimeToUtc(v, TimeZoneInfo.Local),
                v => v.Kind == DateTimeKind.Utc ? TimeZoneInfo.ConvertTimeFromUtc(v, TimeZoneInfo.Local) : v);

+            modelBuilder.Entity<Todo>()
+                .Property(x => x.ExecutionDate)
+                .HasConversion(datetimeConverter);
        }
```
16. ã“ã‚Œã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã¯DateTimeã‚’UTCã¨ã—ã¦ä¿å­˜ã—ã€ç”»é¢ã«ã¯JSTã§è¡¨ç¤ºã™ã‚‹æº–å‚™ãŒã§ãã¾ã—ãŸã€‚å†ã³ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œã—ã¦Todoã‚’è¿½åŠ ã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/1516a2e51bb4-20231017.png)
17. ä»Šåº¦ã¯ç„¡äº‹ã«ç™»éŒ²ã§ãã€JSTã®æ—¥æ™‚ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/56a91f350046-20231017.png)
18. psqlã‚³ãƒãƒ³ãƒ‰ã§ç™»éŒ²ã—ãŸExecutionDateã‚’ç¢ºã‹ã‚ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/57e7450fa166-20231017.png)
19. GitHubã«ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚

https://github.com/MasayukiHattori/EFCoreUTC